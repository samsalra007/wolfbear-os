#!/bin/sh

echo "[initramfs] Buscando instalación..."

# 1. Intenta montar la raíz del sistema
mkdir -p /mnt/vda-root

lsblk

mount /dev/vda2 /mnt/vda-root || {
    echo "[initramfs] WolfbearOS no detectó una partición válida del sistema operativo."
    echo "            Iniciando proceso de instalación.."
    sleep 1

    echo ""
    exec /install/run

    echo "Instalación completa, por favor reinicie su equipo.."
    sleep 60
}

if [ -f /mnt/vda-root/.wolfbearOSInstalled ]; then
    echo "[initramfs] WolfbearOS detectó un sistema instalado"
	exec /launch/run
else
    echo "[initramfs] WolfbearOS detectó un disco pero no contiene el sistema operativo."
    echo "            Iniciando proceso de instalación.."
    sleep 1

    echo ""
    exec /install/run
fi


# echo "=== Iniciando WolfbearOS ==="

# echo "- Creando directorios del sistema para montar particiones"
# mkdir -p /proc /sys /dev /dev/dri /mnt/install

# echo "- Montando proc, sysfs and devtmpfs"
# mount -t proc proc /proc
# mount -t sysfs sysfs /sys
# mount -t devtmpfs devtmpfs /dev

# echo "- Montando recursos de instalación"
# mount -t ext4 /dev/vda3 /mnt/install/

# while true; do
# 	echo "WolfbearOS initramfs"
# 
# 	/sbin/getty -L ttyAMA0 115200 vt1000

# 	echo "Woof bye!"
# 	sleep 2
# done
